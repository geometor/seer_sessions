task_description: "Cyclically shift vertical lines based on their relative horizontal positions."
elements:
  - element: "grid"
    attributes:
      - "2D array of integers (colors)"
      - "variable dimensions"
  - element: "background"
    attributes:
      - "color: orange (7)"
      - "fills most of the grid"
      - "static, remains unchanged"
  - element: "vertical_line"
    attributes:
      - "object"
      - "contiguous block of non-background color"
      - "one pixel wide"
      - "variable height and vertical position"
      - "maintains color and vertical extent during transformation"
      - "moves horizontally"
relationships:
  - type: "relative_position"
    between: ["vertical_line", "vertical_line"]
    detail: "Lines are ordered horizontally based on their column index."
transformation:
  - action: "identify"
    target: "vertical_line"
    criteria: "non-background color, 1 pixel width"
    result: "list of lines with color, column, start_row, end_row"
  - action: "extract_columns"
    source: "identified lines"
    result: "list of unique column indices containing lines"
  - action: "sort_columns"
    source: "list of unique column indices"
    result: "sorted list of column indices (`sorted_cols`)"
  - action: "map_columns"
    source: "sorted_cols"
    rule: "Map column at `sorted_cols[i]` to column at `sorted_cols[(i + 1) % len(sorted_cols)]`"
    result: "mapping from initial column to final column"
  - action: "reconstruct_grid"
    steps:
      - "Create output grid of same dimensions as input, filled with background color."
      - "For each identified vertical line:"
      - "  Get its initial column `c_in`."
      - "  Find its final column `c_out` using the map_columns result."
      - "  Draw the line with its original color and vertical extent at column `c_out` in the output grid."