
## train_1

**input:**
```
0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0
0 4 8 4 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 8 0
0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0
4 0 4 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 8 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0
```


**output:**
```
0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0
0 4 8 4 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 4 8 4
0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0
4 8 4 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 4 8 4 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0
```


## train_2

**input:**
```
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 3 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 8 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 8 6 8 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 8 0 0 0 0 0 0 0 0 0 0 0 0 6 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 1 0 1 0 0 0 0 0 0 0 0 0 0 0 0 8 0 0 0 0 0
0 0 3 0 0 0 0 0 0 6 0 0 0 0 0 8 0 8 0 0 0 0
0 1 0 1 0 0 0 0 0 0 0 0 0 0 0 0 8 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
```


**output:**
```
0 0 0 0 0 0 0 0 0 0 0 0 1 0 1 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 3 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 1 0 1 0 0 0 0 0 0 0
0 0 0 0 0 0 8 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 8 6 8 0 0 0 0 0 0 0 0 0 0 0 8 0 0
0 0 0 0 0 0 8 0 0 0 0 0 0 0 0 0 0 0 8 6 8 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 8 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 1 0 1 0 0 0 0 0 8 0 0 0 0 0 0 8 0 0 0 0 0
0 0 3 0 0 0 0 0 8 6 8 0 0 0 0 8 6 8 0 0 0 0
0 1 0 1 0 0 0 0 0 8 0 0 0 0 0 0 8 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
```


## train_3

**input:**
```
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 8 2 8 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 8 0 8 0 0 0 0 0 0 0 0
0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 3 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 2 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 3 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
```


**output:**
```
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 8 2 8 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 8 2 8 0 0 0 0 0 0 0 0
0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 3 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 8 2 8 0 0 0 0 0 1 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 3 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0
```

Okay, let's break down the perception, facts, and the transformation program for this task.

**Perception of Elements:**

1.  **Background:** The grid primarily consists of a white background (color 0).
2.  **Objects/Patterns:** There are distinct objects or patterns present in the input grids:
    *   **Line Patterns:** Symmetrical patterns of the form `X Z X` appear both horizontally (1x3) and vertically (3x1), where `X` is a specific color (e.g., yellow-4, azure-8, blue-1) and `Z` is the central color, which can be white (0) or another color. Examples: `4 8 4`, `4 0 4`, `8 0 8`, `1 / 3 / 1`.
    *   **Plus Patterns:** A central color `Z` surrounded orthogonally by color `X`. Example: `8 6 8` plus-shape.
    *   **H-Patterns:** A central color `Z` surrounded diagonally and orthogonally by color `X` in an H-shape. Example: `1 0 1 / 0 3 0 / 1 0 1`.
    *   **Markers:** Isolated single pixels of a non-white color (e.g., azure-8, magenta-6, green-3, red-2) that are surrounded only by white pixels or grid boundaries. These markers seem to act as triggers or sources of color information.
3.  **Transformation:** The core transformation involves interaction between the isolated "marker" pixels and the structured "patterns". It appears that:
    *   A marker pixel's color is used to fill or define the central color of a pattern.
    *   The pattern (potentially modified with the marker's color) is then copied or stamped onto the grid, centered at the original location of the marker pixel.
    *   The original pattern might also be updated if its central color was initially white.

**YAML Facts:**


```yaml
task_context:
  grid_properties:
    - background_color: 0 (white)
    - elements: patterns, markers

identified_objects:
  - object_type: pattern
    description: Symmetrical structures with a frame color (X) and a center color (Z).
    subtypes:
      - line: 1x3 horizontal or 3x1 vertical (X Z X)
      - plus: Center Z, orthogonal frame X
      - H-shape: Center Z, specific corner/side frame X
    properties:
      - frame_color: X (non-white)
      - center_color: Z (can be white or non-white)
      - location: center coordinates
      - orientation: horizontal, vertical, N/A
      - shape: line, plus, H
  - object_type: marker
    description: Isolated single non-white pixel Y surrounded by white.
    properties:
      - color: Y (non-white)
      - location: coordinates
      - isolated: true (surrounded by white/boundary)

relationships:
  - type: proximity
    description: Spatial closeness between a marker and a pattern. Measured by distance between marker coordinates and pattern center.
  - type: color_transfer
    description: The color (Y) of a marker determines the new center color of a target pattern.
  - type: template_copy
    description: A pattern structure (potentially modified) is copied to the location of a marker.
  - type: conditional_update
    description: An original pattern is updated only if its initial center color was white (0).

actions:
  - action: find_patterns
    description: Identify all instances of defined pattern types in the input grid.
    inputs: input_grid
    outputs: list of pattern objects (type, frame_color, center_color, location, shape)
  - action: find_markers
    description: Identify all isolated single non-white pixels in the input grid.
    inputs: input_grid
    outputs: list of marker objects (color, location)
  - action: associate_marker_pattern
    description: For each marker, find the closest pattern based on distance.
    inputs: marker, list of patterns
    outputs: associated pattern
  - action: modify_pattern
    description: Create a new pattern instance using the source pattern's frame and shape, but the marker's color as the center.
    inputs: source_pattern, marker_color
    outputs: modified_pattern
  - action: stamp_pattern
    description: Copy the pixels of a pattern onto the grid, centered at a specific location.
    inputs: pattern_to_stamp, target_location, target_grid
    outputs: updated_target_grid
  - action: update_original_pattern
    description: If the source pattern's original center color was white, update its representation in the target grid with the marker's color.
    inputs: source_pattern, marker_color, target_grid
    outputs: updated_target_grid

transformation_goal:
  description: >
    Use isolated marker pixels (Y) to define the center color of the closest source pattern (X Z X structure).
    Copy this potentially modified pattern (X Y X structure) to the marker's location.
    Update the original source pattern's center to Y only if it was originally white (0).
```


**Natural Language Program:**

1.  **Initialization:** Create an output grid as an identical copy of the input grid.
2.  **Identify Source Patterns:** Scan the input grid to find all instances of predefined symmetrical patterns (like `X Z X` lines, `X Z X` plus-shapes, `X Z X` H-shapes). For each pattern found, record its type, shape, frame color `X`, center color `Z`, and the coordinates of its center pixel.
3.  **Identify Target Markers:** Scan the input grid to find all isolated single pixels of a non-white color `Y`. A pixel is isolated if all its orthogonal and diagonal neighbors are white (0) or off the grid boundary. Record the color `Y` and coordinates for each marker found. Ensure markers are not part of the identified source patterns.
4.  **Process Each Marker:** Iterate through each identified target marker `Y` located at `loc_Y`.
    a.  **Find Closest Pattern:** Calculate the Euclidean distance from `loc_Y` to the center coordinates of every identified source pattern `P`. Select the source pattern `P` (with frame color `X`, center color `Z`, located at `loc_P`) that has the minimum distance to `loc_Y`.
    b.  **Create Modified Pattern:** Construct a new pattern instance, `P'`, which has the same shape and frame color `X` as the selected source pattern `P`, but its center color is set to the marker's color `Y`.
    c.  **Stamp Modified Pattern:** Overwrite the pixels in the *output grid* corresponding to the area of `P'`, centered at the marker's original location `loc_Y`.
    d.  **Conditionally Update Original Pattern:** Examine the original center color `Z` of the selected source pattern `P`. If `Z` was white (0), update the center pixel of that pattern at its original location `loc_P` in the *output grid* to the marker color `Y`. If `Z` was not white (0), the original pattern at `loc_P` in the output grid remains unchanged from the initial copy.
5.  **Finalization:** After processing all markers, the modified output grid represents the final result.
