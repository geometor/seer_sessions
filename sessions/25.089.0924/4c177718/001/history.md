
## train_1

**input:**
```
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 1 1 1 0 0 2 0 0 0 3 0 0 0
0 0 1 0 1 0 0 2 0 0 3 3 3 0 0
0 0 1 1 1 0 2 2 2 0 0 3 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
5 5 5 5 5 5 5 5 5 5 5 5 5 5 5
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 1 1 1 0 0 0 0 0 0 0
0 0 0 0 0 1 0 1 0 0 0 0 0 0 0
0 0 0 0 0 1 1 1 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
```


**output:**
```
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 3 0 0 0 0 0 0 0 0
0 0 0 0 0 3 3 3 0 0 0 0 0 0 0
0 0 0 0 0 0 3 0 0 0 0 0 0 0 0
0 0 0 0 0 1 1 1 0 0 0 0 0 0 0
0 0 0 0 0 1 0 1 0 0 0 0 0 0 0
0 0 0 0 0 1 1 1 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
```


## train_2

**input:**
```
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 1 0 1 0 0 2 0 0 4 4 4 0 0
0 0 0 1 0 0 0 2 0 0 4 4 4 0 0
0 0 1 0 1 0 2 2 2 0 0 4 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
5 5 5 5 5 5 5 5 5 5 5 5 5 5 5
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 1 0 1 0 0 0 0 0 0 0
0 0 0 0 0 0 1 0 0 0 0 0 0 0 0
0 0 0 0 0 1 0 1 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
```


**output:**
```
0 0 0 0 0 4 4 4 0 0 0 0 0 0 0
0 0 0 0 0 4 4 4 0 0 0 0 0 0 0
0 0 0 0 0 0 4 0 0 0 0 0 0 0 0
0 0 0 0 0 1 0 1 0 0 0 0 0 0 0
0 0 0 0 0 0 1 0 0 0 0 0 0 0 0
0 0 0 0 0 1 0 1 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
```


## train_3

**input:**
```
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 1 0 0 2 2 2 0 6 6 6 0 0
0 0 1 1 1 0 0 2 0 0 6 0 6 0 0
0 0 0 1 0 0 0 2 0 0 0 6 6 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
5 5 5 5 5 5 5 5 5 5 5 5 5 5 5
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 1 0 0 0 0 0 0 0
0 0 0 0 0 0 1 1 1 0 0 0 0 0 0
0 0 0 0 0 0 0 1 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
```


**output:**
```
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 1 0 0 0 0 0 0 0
0 0 0 0 0 0 1 1 1 0 0 0 0 0 0
0 0 0 0 0 0 0 1 0 0 0 0 0 0 0
0 0 0 0 0 0 6 6 6 0 0 0 0 0 0
0 0 0 0 0 0 6 0 6 0 0 0 0 0 0
0 0 0 0 0 0 0 6 6 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
```


## train_4

**input:**
```
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 1 1 0 0 2 2 2 0 0 7 0 0 0
0 0 0 1 0 0 0 2 0 0 7 0 7 0 0
0 0 0 1 1 0 0 2 0 0 0 7 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
5 5 5 5 5 5 5 5 5 5 5 5 5 5 5
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 1 1 0 0 0 0 0
0 0 0 0 0 0 0 0 0 1 0 0 0 0 0
0 0 0 0 0 0 0 0 0 1 1 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
```


**output:**
```
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 1 1 0 0 0 0 0
0 0 0 0 0 0 0 0 0 1 0 0 0 0 0
0 0 0 0 0 0 0 0 0 1 1 0 0 0 0
0 0 0 0 0 0 0 0 0 7 0 0 0 0 0
0 0 0 0 0 0 0 0 7 0 7 0 0 0 0
0 0 0 0 0 0 0 0 0 7 0 0 0 0 0
```

Okay, let's analyze the provided examples.

**Perception:**

1.  **Input Structure:** The input grids consistently feature a horizontal line of gray pixels (color 5) separating the grid into an upper and a lower section.
2.  **Objects:**
    *   The upper section contains multiple distinct objects, each made of a single, non-background color. In all examples, there are exactly three objects in the upper section.
    *   The lower section contains exactly one object, also made of a single, non-background color.
3.  **Key Features:**
    *   The gray line acts as a separator.
    *   Among the three objects in the top section, one object always perfectly matches the object in the bottom section in terms of both color and shape.
    *   Another object in the top section is consistently a red (color 2) 'H' shape across all examples.
    *   The third object in the top section varies in color and shape between examples.
4.  **Transformation:**
    *   The output grid is smaller vertically (9 rows) than the input grid (15 rows) but maintains the same width (15 columns).
    *   The gray separator line is removed.
    *   Only two objects from the input are present in the output: the object from the bottom section and the unique third object from the top section (the one that doesn't match the bottom object and isn't the red 'H').
    *   These two selected objects are stacked vertically in the output grid, separated by one row of background pixels.
5.  **Stacking Order:** The vertical order of the two selected objects in the output varies:
    *   In `train_1` and `train_2`, the object originally from the top section is placed above the object originally from the bottom section.
    *   In `train_3` and `train_4`, the object originally from the bottom section is placed above the object originally from the top section.
    *   This order appears to depend on the color of the unique top object: if its color index is > 5 (magenta=6, orange=7), the bottom object goes on top. If its color index is <= 5 (green=3, yellow=4), the top object goes on top.
6.  **Positioning:**
    *   The pair of objects in the output is vertically centered within the 9 rows (1 row padding top, 3 rows for object 1, 1 row gap, 3 rows for object 2, 1 row padding bottom).
    *   Horizontally, the pair of objects seems to be positioned based on the horizontal position of the *bottom* object in the original input grid. Both objects in the output share the same horizontal centering.

**Facts (YAML):**


```yaml
input_features:
  - separator:
      color: 5 # gray
      orientation: horizontal
      description: Divides grid into upper and lower sections.
  - upper_section_objects:
      count: 3
      properties:
        - contiguous: true
        - single_color: true
        - non_background: true
      types:
        - match_object:
            description: Identical shape and color to the lower_section_object.
        - ignore_object:
            color: 2 # red
            shape: H # Specific consistent shape
            description: This object is consistently present and ignored in the output.
        - target_object:
            description: The remaining object, differs in shape and color across examples.
  - lower_section_object:
      count: 1
      properties:
        - contiguous: true
        - single_color: true
        - non_background: true
      description: Referred to as the 'bottom_object'.

transformation:
  - select_objects:
      - source: lower_section_object # bottom_object
      - source: target_object # from upper_section_objects
  - arrange_objects:
      output_grid_size:
        height: 9
        width: input_width
      vertical_stacking:
        order_rule:
          if: target_object.color > 5
          then: [bottom_object, target_object] # bottom object on top
          else: [target_object, bottom_object] # target object on top
        gap: 1 row of background pixels (color 0)
      vertical_padding: 1 row top and bottom
      horizontal_positioning:
        reference: center column of bottom_object's bounding box in input
        alignment: Both output objects are centered according to the reference.
  - background: color 0 # white

```


**Natural Language Program:**

1.  Identify the horizontal line composed entirely of gray (5) pixels. This line divides the input grid into an upper and lower part.
2.  Find all contiguous, single-color, non-background objects in the upper part and the lower part. There will be exactly one object (`bottom_object`) in the lower part and three objects in the upper part.
3.  Compare the `bottom_object` (shape and color) with the three upper objects. Identify the upper object (`match_object`) that is identical to the `bottom_object`.
4.  Identify the upper object that is red (2) and has an 'H' shape (`ignore_object`).
5.  The third upper object is the `target_top_object`.
6.  Determine the vertical stacking order for the output based on the color of the `target_top_object`:
    *   If the color index of `target_top_object` is greater than 5, the `bottom_object` will be placed above the `target_top_object` in the output.
    *   Otherwise (color index <= 5), the `target_top_object` will be placed above the `bottom_object`.
7.  Create a new output grid with 9 rows and the same width as the input grid, filled with the background color (0).
8.  Calculate the horizontal center column of the `bottom_object`'s bounding box in the input grid. This is the reference horizontal position.
9.  Place the object designated to be vertically topmost (from step 6) into the output grid starting at row index 1. Horizontally position this object so its center aligns with the reference horizontal position.
10. Place the object designated to be vertically bottommost (from step 6) into the output grid starting at row index 5 (allowing for the 3-row height of the top object and a 1-row gap). Horizontally position this object so its center aligns with the reference horizontal position.
11. Return the constructed output grid.
