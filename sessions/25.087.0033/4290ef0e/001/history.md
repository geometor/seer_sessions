
## train_1

**input:**
```
8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8
8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8
8 8 1 1 1 8 1 1 1 8 8 8 8 8 8 8 8 8
8 8 1 8 8 8 8 8 1 8 8 8 8 8 8 8 8 8
8 8 1 8 8 8 8 8 1 8 8 8 8 8 8 8 8 8
8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8
8 8 1 8 8 8 8 8 1 8 8 8 8 0 8 8 8 8
8 8 1 8 8 8 8 8 1 8 8 8 8 8 8 8 8 8
8 8 1 1 1 8 1 1 1 8 8 8 8 8 8 8 8 8
8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8
8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8
8 4 4 4 8 8 8 8 8 8 8 8 8 8 8 8 8 8
8 4 8 4 8 8 8 2 2 8 2 2 8 8 8 8 8 8
8 4 4 4 8 8 8 2 8 8 8 2 8 8 8 8 8 8
8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8
8 8 8 8 8 8 8 2 8 8 8 2 8 8 8 8 8 8
8 8 8 8 8 8 8 2 2 8 2 2 8 8 8 8 8 8
8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8
```


**output:**
```
1 1 1 8 1 1 1
1 2 2 8 2 2 1
1 2 4 4 4 2 1
8 8 4 0 4 8 8
1 2 4 4 4 2 1
1 2 2 8 2 2 1
1 1 1 8 1 1 1
```


## train_2

**input:**
```
4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4
4 4 4 4 4 4 4 4 4 4 4 4 3 3 3 4 4
4 4 4 1 1 4 1 1 4 4 4 4 3 4 3 4 4
4 4 4 1 4 4 4 1 4 4 4 4 3 3 3 4 4
4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4
4 4 4 1 4 4 4 1 4 4 4 4 4 4 4 4 4
4 4 4 1 1 4 1 1 4 4 4 4 4 4 4 4 4
4 4 4 4 4 4 4 4 4 4 6 6 4 4 4 6 6
4 4 4 4 4 4 4 4 4 4 6 4 4 4 4 4 6
4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4
4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4
4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4
4 4 4 4 4 4 4 4 4 4 6 4 4 4 4 4 6
```


**output:**
```
6 6 4 4 4 6 6
6 1 1 4 1 1 6
4 1 3 3 3 1 4
4 4 3 4 3 4 4
4 1 3 3 3 1 4
6 1 1 4 1 1 6
6 6 4 4 4 6 6
```


## train_3

**input:**
```
3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3
2 2 2 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3
3 3 2 3 3 1 1 1 3 3 3 1 1 1 3 8 8 3
3 3 2 3 3 1 3 3 3 3 3 3 3 1 3 8 3 3
3 3 3 3 3 1 3 3 3 3 3 3 3 1 3 3 3 3
3 3 2 3 3 3 3 3 3 3 3 3 3 3 3 8 3 3
3 3 2 3 3 3 3 7 7 7 3 3 3 3 3 8 8 3
2 2 2 3 3 3 3 7 3 7 3 3 3 3 3 3 3 3
3 3 3 3 3 1 3 7 7 7 3 3 3 1 3 3 3 3
3 3 3 3 3 1 3 3 3 3 3 3 3 1 3 3 3 3
3 3 3 3 3 1 1 1 3 3 3 1 1 1 3 3 3 3
3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3
3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3
3 3 3 4 4 3 3 3 3 3 3 3 4 4 3 3 3 3
3 3 3 4 3 3 3 3 3 3 3 3 3 4 3 3 3 3
3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3
3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 6 3
3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3
```


**output:**
```
4 4 3 3 3 3 3 3 3 4 4
4 1 1 1 3 3 3 1 1 1 4
3 1 2 2 2 3 2 2 2 1 3
3 1 2 8 8 3 8 8 2 1 3
3 3 2 8 7 7 7 8 2 3 3
3 3 3 3 7 6 7 3 3 3 3
3 3 2 8 7 7 7 8 2 3 3
3 1 2 8 8 3 8 8 2 1 3
3 1 2 2 2 3 2 2 2 1 3
4 1 1 1 3 3 3 1 1 1 4
4 4 3 3 3 3 3 3 3 4 4
```

**Perception of Task Elements:**

1.  **Input/Output Grids:** The task takes a larger input grid containing multiple scattered shapes and produces a smaller output grid which is a composite image formed by overlaying specific shapes from the input.
2.  **Background Color:** Each input grid has a dominant color (azure 8, yellow 4, green 3) acting as a background. This background color is largely ignored in the input shapes but is used as the initial fill color for the output grid.
3.  **Shape Identification:** The core of the task involves identifying specific geometric shapes within the input grid, ignoring the background color. Key shapes observed include:
    *   'H' shapes (e.g., 5x7 blue in Ex1, 5x7 blue in Ex2, 9x7 blue in Ex3)
    *   'C' shapes (e.g., 3x3 yellow in Ex1, 3x3 green in Ex2, 3x3 orange in Ex3)
    *   'L' shapes (e.g., 3x3 magenta corners in Ex2, 3x3 yellow corners in Ex3)
    *   Other patterns (e.g., 5x5 red 'H' in Ex1, 5x5 red pattern + azure box in Ex3)
    *   Single Pixels (e.g., white 0 in Ex1, magenta 6 in Ex3)
4.  **Layering/Composition:** The output grid is constructed by layering these identified shapes according to a consistent template, centered within the output grid dimensions. The layering order observed is generally: Outermost corners ('L' shapes) > Outer frame ('H' shape) > Inner patterns (Red shapes) > Innermost shape ('C' shape).
5.  **Center Pixel Modification:** If a unique single-pixel object exists in the input, its color replaces the color of the exact center pixel in the final composite output image.
6.  **Output Grid Size:** The dimensions of the output grid are determined by the bounding box of the shape(s) forming the outermost layer of the composite image (e.g., 7x7 for the blue H in Ex1, 7x7 for the magenta Ls in Ex2, 11x11 for the yellow Ls in Ex3).
7.  **Color Handling:** Shapes retain their original colors from the input. The initial output grid is filled with the input's background color. Shapes are drawn sequentially onto this grid, overwriting existing colors. The final center pixel might be overwritten again by the single-pixel object's color.

**Facts YAML:**

```
yaml
task_description: Identify specific geometric shapes (L, H, C, others) and single pixels in the input grid, ignoring the background color. Construct the output grid by layering these shapes according to a predefined template (L corners -> H frame -> inner patterns -> C center) onto a canvas initialized with the input background color. The output size is determined by the outermost layer's bounding box. If a unique single pixel object exists, its color replaces the center pixel of the final output.

elements:
  - object: grid
    properties:
      - type: input_grid
      - type: output_grid
      - background_color: The most frequent color in the input grid. Determined per example.
  - object: shape
    properties:
      - classification: Geometric type (e.g., H_shape, C_shape, L_shape_corners, Red_pattern, Single_pixel).
      - color: The original color of the shape pixels in the input grid.
      - location: Scattered in the input grid, relevant for identification.
      - layer_role: Assigned to a specific layer in the output composition (outermost, intermediate, inner, center_replacement).
      - size: Dimensions defining the shape (e.g., 3x3, 5x7).

relationships:
  - type: identification
    description: Shapes are distinguished from the background and from each other based on color and contiguity.
  - type: classification
    description: Identified shapes are categorized by their geometric form.
  - type: layering_order
    description: Shapes are drawn onto the output grid in a specific sequence, typically from outermost to innermost (L -> H -> Red -> C).
  - type: spatial_composition
    description: Shapes are centered and overlaid within the output grid dimensions.
  - type: center_replacement
    description: A unique single-pixel object's color overwrites the exact center pixel of the composed output grid.

actions:
  - action: identify_background_color
    actor: system
    input: input_grid
    output: background_color
  - action: find_and_classify_shapes
    actor: system
    input: input_grid, background_color
    output: classified_shapes (map of shape_type -> list of {shape_object, color})
    description: Locate all non-background objects and classify them by geometry (L, H, C, Red, Single_pixel), storing their colors.
  - action: determine_output_dimensions
    actor: system
    input: classified_shapes
    output: width, height
    description: Calculate the bounding box size of the shape designated as the outermost layer (L-corners if present, otherwise the main H-shape).
  - action: create_initial_output_grid
    actor: system
    input: width, height, background_color
    output: output_grid
    description: Initialize the output grid filled with the input background color.
  - action: layer_shapes
    actor: system
    input: output_grid, classified_shapes
    output: modified_output_grid
    description: Draw the classified shapes onto the output grid, centered, in the predefined order (L -> H -> Red -> C), overwriting existing pixels.
  - action: apply_center_pixel
    actor: system
    input: modified_output_grid, classified_shapes
    output: final_output_grid
    description: If a Single_pixel shape exists, change the color of the center pixel of the grid to the Single_pixel's color.

