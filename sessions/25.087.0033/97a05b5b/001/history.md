
## train_1

**input:**
```
0 0 0 0 0 0 0 0 0 0
0 2 2 2 2 2 2 2 2 0
0 2 2 0 2 2 2 2 2 0
0 2 0 0 0 2 2 2 2 0
0 2 2 2 2 2 2 2 2 0
0 2 2 2 2 0 0 2 2 0
0 2 2 2 2 0 2 0 2 0
0 2 2 2 2 2 0 0 2 0
0 2 2 2 2 2 2 2 2 0
0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0
0 4 2 4 0 0 0 0 0 0
0 2 2 4 0 0 0 0 0 0
0 4 2 4 0 2 2 3 0 0
0 0 0 0 0 2 3 2 0 0
0 0 0 0 0 3 2 2 0 0
0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0
```


**output:**
```
2 2 2 2 2 2 2 2
2 4 2 4 2 2 2 2
2 2 2 2 2 2 2 2
2 4 4 4 2 2 2 2
2 2 2 2 2 2 3 2
2 2 2 2 2 3 2 2
2 2 2 2 3 2 2 2
2 2 2 2 2 2 2 2
```


## train_2

**input:**
```
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 2 2 2 2 2 2 2 2 2 0 0 0 0 0 0 0 0
0 0 2 0 2 2 2 2 2 0 2 0 0 1 2 1 0 0 0
0 0 2 0 0 2 2 2 2 0 2 0 0 2 2 2 0 0 0
0 0 2 2 2 2 2 2 2 0 2 0 0 1 2 1 0 0 0
0 0 2 2 2 2 2 2 2 2 2 0 0 0 0 0 0 0 0
0 0 2 2 2 2 2 2 2 2 2 0 0 0 0 0 0 0 0
0 0 2 2 2 2 0 2 2 2 2 0 0 0 3 3 3 0 0
0 0 2 2 2 0 0 0 2 2 2 0 0 0 2 2 2 0 0
0 0 2 2 2 2 0 2 2 2 2 0 0 0 3 3 3 0 0
0 0 2 2 2 2 2 2 2 2 2 0 0 0 0 0 0 0 0
0 0 2 2 2 2 2 2 2 2 2 0 0 0 0 0 0 0 0
0 0 2 2 2 2 2 2 2 2 2 0 0 0 0 0 0 0 0
0 0 2 2 2 2 2 2 2 2 2 0 0 0 0 0 0 0 0
0 0 2 0 0 2 2 2 0 2 2 0 0 0 0 0 0 0 0
0 0 2 2 0 2 2 2 0 2 2 0 0 0 0 0 0 0 0
0 0 2 0 0 2 2 0 0 0 2 0 0 0 0 0 0 0 0
0 0 2 2 2 2 2 2 2 2 2 0 0 0 8 8 8 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 2 8 2 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 2 2 2 0 0
0 0 0 4 4 4 0 0 5 5 2 0 0 0 0 0 0 0 0
0 0 0 4 2 4 0 0 2 2 2 0 0 0 0 0 0 0 0
0 0 0 2 2 4 0 0 5 5 2 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
```


**output:**
```
2 2 2 2 2 2 2 2 2
2 2 4 4 2 2 3 2 3
2 2 2 4 2 2 3 2 3
2 4 4 4 2 2 3 2 3
2 2 2 2 2 2 2 2 2
2 2 2 2 2 2 2 2 2
2 2 2 1 2 1 2 2 2
2 2 2 2 2 2 2 2 2
2 2 2 1 2 1 2 2 2
2 2 2 2 2 2 2 2 2
2 2 2 2 2 2 2 2 2
2 2 2 2 2 2 2 2 2
2 2 2 2 2 2 2 2 2
8 2 2 2 2 5 2 5 2
8 8 2 2 2 5 2 5 2
8 2 2 2 2 2 2 2 2
2 2 2 2 2 2 2 2 2
```


## train_3

**input:**
```
0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 8 2 8 0 0 0 0
0 0 0 0 0 2 2 2 0 0 0 0
0 0 0 0 0 8 2 8 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0
0 2 2 2 2 2 2 2 2 2 0 0
0 2 2 2 2 2 2 2 2 2 0 0
0 2 2 2 0 2 2 2 2 2 0 0
0 2 2 0 0 0 2 2 2 2 0 0
0 2 2 2 0 2 2 2 2 2 0 0
0 2 2 2 2 2 2 2 2 2 0 0
0 2 2 2 2 2 2 2 2 2 0 0
0 2 2 2 2 2 2 2 2 2 0 0
0 2 2 2 2 2 2 2 2 2 0 0
0 0 0 0 0 0 0 0 0 0 0 0
```


**output:**
```
2 2 2 2 2 2 2 2 2
2 2 2 2 2 2 2 2 2
2 2 8 2 8 2 2 2 2
2 2 2 2 2 2 2 2 2
2 2 8 2 8 2 2 2 2
2 2 2 2 2 2 2 2 2
2 2 2 2 2 2 2 2 2
2 2 2 2 2 2 2 2 2
2 2 2 2 2 2 2 2 2
```

Okay, let's break down this task.

**Perception**

1.  **Input Grid Structure:** The input grids contain a large, prominent object made of red (2) pixels. This red object often has internal "holes" filled with white (0) pixels. Additionally, scattered elsewhere in the input grid (usually separated by white pixels) are smaller, distinct objects made of various other colors (yellow, green, blue, gray, azure). The overall grid includes significant areas of white background pixels (0).
2.  **Output Grid Structure:** The output grid is smaller than the input grid. It appears to be a cropped version derived from the large red object in the input. The output grid maintains the basic shape of the red object but the internal white holes are now filled with colors corresponding to the smaller objects found in the input.
3.  **Transformation:** The core transformation seems to involve:
    *   Identifying the main red object.
    *   Identifying the smaller "pattern" or "stamp" objects.
    *   Locating the white holes *within* the main red object.
    *   Matching the *shape* of each white hole to the *shape* of one of the stamp objects.
    *   "Painting" or filling the white hole in the red object with the colors from the matched stamp object, preserving the relative arrangement of colors.
    *   The final output is the modified red object, cropped to its bounding box.

**Facts**


```yaml
elements:
  - object: MainRedObject
    description: The largest contiguous area of red (2) pixels in the input grid. It often contains internal holes.
    properties: [color: red, shape: variable, contains_holes: often true]
  - object: StampObject
    description: Smaller contiguous objects made of non-red, non-white colors, located separately from the MainRedObject.
    properties: [color: various (non-red, non-white), shape: specific pattern, size: smaller than MainRedObject]
  - object: WhiteHole
    description: Contiguous areas of white (0) pixels located inside the MainRedObject's boundary, surrounded by red pixels.
    properties: [color: white, shape: specific pattern, location: inside MainRedObject]
  - object: Background
    description: Pixels with color white (0) surrounding the main objects.
    properties: [color: white]

actions:
  - action: IdentifyAndLocate
    target: MainRedObject
    result: Bounding box coordinates and pixel map of the MainRedObject.
  - action: IdentifyAndLocate
    target: StampObjects
    result: List of StampObjects, each with its bounding box, shape (relative coordinates), and pattern (relative coordinates to color map).
  - action: IdentifyAndLocate
    target: WhiteHoles
    result: List of WhiteHoles within the MainRedObject, each with its shape (relative coordinates within MainRedObject's bounding box) and location.
  - action: MatchShapes
    source: WhiteHole shapes
    target: StampObject shapes
    result: Pairing of WhiteHoles with StampObjects that have identical shapes (set of relative coordinates).
  - action: FillHole
    target: WhiteHole in an intermediate output grid (initially a copy of the MainRedObject)
    using: Pattern (colors and relative positions) from the matched StampObject.
    result: The WhiteHole area in the intermediate output grid is replaced with the StampObject's pattern.
  - action: Crop
    target: MainRedObject (after holes are filled)
    using: Bounding box of the MainRedObject.
    result: The final output grid.

relationships:
  - type: ShapeEquivalence
    between: WhiteHole, StampObject
    description: A WhiteHole's shape (relative pixel coordinates) must exactly match a StampObject's shape (relative pixel coordinates within its own bounding box) for a fill operation to occur.
  - type: Containment
    container: MainRedObject
    contains: WhiteHoles
  - type: PositionalCorrespondence
    between: WhiteHole pixels, StampObject pixels
    description: When filling a hole, the color of a pixel in the StampObject pattern is applied to the pixel at the corresponding relative position within the WhiteHole area in the output.
```


**Natural Language Program**

1.  Find the largest contiguous object consisting solely of red (2) pixels in the input grid (the `MainRedObject`). Determine its bounding box.
2.  Create the initial output grid by copying the `MainRedObject` (including its internal white holes) cropped to its bounding box.
3.  Find all other contiguous objects in the input grid that are composed of non-red (2) and non-white (0) pixels (the `StampObjects`).
4.  For each `StampObject`, determine its bounding box and extract its pattern: a mapping of relative coordinates (within its bounding box) to pixel colors. Also, determine its shape: the set of relative coordinates occupied by non-background pixels within its bounding box.
5.  Identify all contiguous areas of white (0) pixels within the bounding box of the `MainRedObject` that are surrounded by red pixels (the `WhiteHoles`).
6.  For each `WhiteHole`:
    a.  Determine its shape: the set of relative coordinates (within the `MainRedObject`'s bounding box) occupied by the white pixels.
    b.  Search through the identified `StampObjects` to find one whose shape exactly matches the `WhiteHole`'s shape.
    c.  If a matching `StampObject` is found:
        i.  Retrieve the pattern (relative coordinates to color map) of the matching `StampObject`.
        ii. For each relative coordinate `(dr, dc)` and corresponding color `C` in the `StampObject`'s pattern:
            1. Calculate the absolute coordinate `(r, c)` within the output grid corresponding to this relative position within the `WhiteHole`.
            2. Set the pixel at `(r, c)` in the output grid to color `C`.
7.  Return the final modified output grid.
