
## train_1

**input:**
```
2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2
2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2
2 2 2 5 2 2 2 2 2 2 2 2 2 2 2 2 2 5 2 2
2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2
2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2
2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2
2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2
2 2 2 4 4 2 2 2 8 8 2 2 2 2 2 2 2 2 2 2
2 2 4 2 2 4 2 8 2 2 8 2 3 3 2 2 2 2 2 2
2 4 2 2 2 2 4 5 2 2 2 8 2 2 3 2 2 2 2 2
2 4 2 9 2 2 4 2 2 2 3 8 2 9 2 3 2 2 2 2
2 2 4 2 2 4 2 8 2 2 8 2 2 2 2 3 2 2 2 2
2 2 2 4 4 2 2 2 8 8 2 3 2 2 3 2 2 2 2 2
2 2 2 2 2 2 2 2 2 2 2 2 3 3 2 2 2 2 2 2
2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2
2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2
2 2 2 2 2 2 2 2 2 2 5 2 2 2 2 2 2 2 2 2
2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2
2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2
5 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2
```


**output:**
```
2 2 4 4 2 2
2 4 2 2 4 2
4 2 2 2 2 4
4 2 2 2 2 4
2 4 2 2 4 2
2 2 4 4 2 2
2 2 8 8 2 2
2 8 2 2 8 2
8 2 2 2 2 8
8 2 2 2 2 8
2 8 2 2 8 2
2 2 8 8 2 2
2 2 3 3 2 2
2 3 2 2 3 2
3 2 2 2 2 3
3 2 2 2 2 3
2 3 2 2 3 2
2 2 3 3 2 2
```


## train_2

**input:**
```
3 3 3 3 3 3 3 3 3 3
5 3 3 4 4 3 3 3 3 3
3 3 4 3 8 4 3 3 3 3
3 4 3 8 3 3 4 3 3 3
3 4 8 1 3 3 4 8 3 3
3 1 4 3 1 4 3 8 3 3
1 3 3 4 4 1 8 3 3 3
1 3 5 3 8 8 3 3 3 3
3 1 3 3 1 3 3 3 3 3
3 3 1 1 3 3 5 3 3 3
```


**output:**
```
3 3 4 4 3 3
3 4 3 3 4 3
4 3 3 3 3 4
4 3 3 3 3 4
3 4 3 3 4 3
3 3 4 4 3 3
3 3 8 8 3 3
3 8 3 3 8 3
8 3 3 3 3 8
8 3 3 3 3 8
3 8 3 3 8 3
3 3 8 8 3 3
3 3 1 1 3 3
3 1 3 3 1 3
1 3 3 3 3 1
1 3 3 3 3 1
3 1 3 3 1 3
3 3 1 1 3 3
```


## train_3

**input:**
```
4 4 4 4 4 5 4 4 4 4 4 4 4
4 4 4 4 4 4 4 4 4 4 4 7 4
4 4 2 2 4 4 4 4 4 4 4 4 4
4 2 4 4 2 4 4 4 4 4 4 4 4
2 4 4 7 4 2 4 4 4 4 4 4 4
2 4 4 4 4 8 8 4 4 5 4 4 4
4 2 4 4 8 4 4 8 4 4 4 4 4
4 4 2 8 4 4 4 4 8 4 4 4 4
4 4 4 8 4 4 4 4 3 3 4 4 4
4 4 4 4 8 4 4 3 4 4 3 4 4
4 5 4 4 4 8 3 4 4 4 4 3 4
4 4 7 4 4 4 3 4 4 5 4 3 4
4 4 4 4 4 4 4 3 4 4 3 4 4
```


**output:**
```
4 4 3 3 4 4
4 3 4 4 3 4
3 4 4 4 4 3
3 4 4 4 4 3
4 3 4 4 3 4
4 4 3 3 4 4
4 4 8 8 4 4
4 8 4 4 8 4
8 4 4 4 4 8
8 4 4 4 4 8
4 8 4 4 8 4
4 4 8 8 4 4
4 4 2 2 4 4
4 2 4 4 2 4
2 4 4 4 4 2
2 4 4 4 4 2
4 2 4 4 2 4
4 4 2 2 4 4
```


## train_4

**input:**
```
8 8 8 8 8 8 8 8 5 8
8 8 8 8 8 8 8 8 8 8
8 8 8 4 4 8 3 3 8 8
8 8 4 8 8 4 8 8 3 8
8 4 2 8 3 8 4 8 8 3
8 4 8 8 3 8 4 8 8 3
8 8 4 8 8 4 8 8 3 8
8 8 8 4 4 8 3 3 8 8
8 5 8 8 8 8 8 8 8 8
8 8 8 8 8 8 8 2 8 8
```


**output:**
```
8 8 4 4 8 8
8 4 8 8 4 8
4 8 8 8 8 4
4 8 8 8 8 4
8 4 8 8 4 8
8 8 4 4 8 8
8 8 3 3 8 8
8 3 8 8 3 8
3 8 8 8 8 3
3 8 8 8 8 3
8 3 8 8 3 8
8 8 3 3 8 8
```

Okay, let's break down this task.

**Perception of Task Elements:**

1.  **Input/Output Structure:** Both inputs and outputs are grids of colored pixels. The output grid's width is consistently 6 pixels. The output grid's height is always a multiple of 6.
2.  **Background Color:** Each input grid has a dominant color that acts as a background (red=2 in train_1, green=3 in train_2, yellow=4 in train_3, azure=8 in train_4). This background color is also present in the output grids.
3.  **Noise Pixels:** The input grids contain scattered gray pixels (color=5). These gray pixels do not appear in the output grids.
4.  **Patterns:** The core elements being manipulated are distinct 6x6 pixel patterns embedded within the input grid. These patterns are composed of various colors, often including the background color itself.
5.  **Pattern Extraction:** The task involves identifying these 6x6 patterns within the input grid.
6.  **Pattern Cleaning:** Within the identified 6x6 areas in the input, there might be pixels that aren't part of the main pattern color or the background (like the maroon=9 pixel within the yellow=4 pattern area in train_1, or the gray=5 noise pixels). These "impurity" pixels are replaced with the background color in the output patterns. Each output pattern seems to consist only of its "primary" color and the background color.
7.  **Composition:** The output grid is formed by stacking these cleaned 6x6 patterns vertically.
8.  **Ordering:** The order in which the patterns are stacked in the output corresponds to their position in the input grid, scanned row by row, then column by column, based on the top-left corner of each pattern's bounding box.

**YAML Facts:**


```yaml
Task: Extract, clean, and stack 6x6 patterns from an input grid.

Input_Grid:
  Properties:
    - Contains a single background color (most frequent color).
    - Contains noise pixels (always gray=5).
    - Contains embedded 6x6 patterns made of various colors.
    - Patterns may contain the background color.
    - Patterns may overlap noise pixels or pixels from other minor colors.

Output_Grid:
  Properties:
    - Composed of cleaned 6x6 patterns stacked vertically.
    - Width is always 6.
    - Height is 6 * (number of patterns found).
    - Does not contain noise pixels (gray=5).
    - Each pattern contains only its primary color and the background color.

Objects:
  - Background: The most frequent color in the input.
  - Noise: Pixels with the color gray (5).
  - Pattern_Pixel: Any pixel that is not Background and not Noise.
  - Pattern_Component: A connected group (8-way adjacency) of Pattern_Pixels.
  - Raw_Pattern_Area: A 6x6 section of the input grid defined by the bounding box of a Pattern_Component whose bounding box is exactly 6x6.
  - Primary_Color: The most frequent Pattern_Pixel color within a Raw_Pattern_Area.
  - Cleaned_Pattern: A 6x6 grid derived from Raw_Pattern_Area where all pixels not matching the Background or Primary_Color are replaced by the Background color.

Relationships:
  - Pattern_Components define the locations of Raw_Pattern_Areas via their 6x6 bounding boxes.
  - Raw_Pattern_Areas are transformed into Cleaned_Patterns.
  - Cleaned_Patterns are sorted based on the top-left coordinate (row, then column) of their corresponding Raw_Pattern_Area in the input grid.
  - Sorted Cleaned_Patterns are stacked vertically to form the Output_Grid.

Actions:
  - Identify Background color.
  - Identify Noise color (gray=5).
  - Find connected components of Pattern_Pixels.
  - Filter components to keep only those with a 6x6 bounding box.
  - For each valid component:
    - Extract the Raw_Pattern_Area (6x6) from the input grid.
    - Determine the Primary_Color for that area.
    - Generate the Cleaned_Pattern by replacing non-primary, non-background pixels with the Background color.
    - Store the Cleaned_Pattern and its original top-left coordinate.
  - Sort the Cleaned_Patterns by coordinate (row, then column).
  - Vertically concatenate the sorted Cleaned_Patterns.
```


**Natural Language Program:**

1.  **Analyze Input:** Determine the background color by finding the most frequent pixel value in the input grid. Note the noise color is gray (5).
2.  **Identify Pattern Candidates:** Locate all pixels that are neither the background color nor the noise color (gray).
3.  **Group Candidates:** Group these candidate pixels into connected components using 8-way adjacency (including diagonals).
4.  **Filter by Size:** For each component, calculate its bounding box. Keep only those components whose bounding box dimensions are exactly 6x6.
5.  **Extract and Clean:** For each valid 6x6 component found:
    a.  Record the top-left coordinate (minimum row, minimum column) of its bounding box.
    b.  Extract the corresponding 6x6 grid area directly from the input grid (this is the `raw_pattern`).
    c.  Identify the `primary_color` for this `raw_pattern` by finding the most frequent color within it, excluding the background color and the gray noise color.
    d.  Create a `cleaned_pattern` (a new 6x6 grid): Iterate through each pixel of the `raw_pattern`. If the pixel's color is either the `primary_color` or the background color, copy it to the `cleaned_pattern`. Otherwise, place the background color in the `cleaned_pattern`.
    e.  Store the `cleaned_pattern` associated with its top-left coordinate.
6.  **Sort Patterns:** Sort the collected `cleaned_patterns` based on their associated top-left coordinates, primarily by row index and secondarily by column index.
7.  **Assemble Output:** Create the output grid by vertically stacking the sorted `cleaned_patterns` in order.
