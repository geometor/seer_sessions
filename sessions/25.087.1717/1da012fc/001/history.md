
## train_1

**input:**
```
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 1 1 1 1 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 1 1 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 1 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 1 1 1 1 1 0 0
0 5 2 5 5 5 5 0 0 0 0 0 0 0 1 0 1 0 0 0
0 5 5 5 5 5 5 0 0 0 0 0 0 0 0 0 0 0 0 0
0 5 5 5 4 5 5 0 0 0 0 0 0 0 0 0 0 0 0 0
0 5 5 5 5 5 5 0 0 1 1 0 0 0 0 0 0 1 0 0
0 5 6 5 5 3 5 0 1 1 1 1 0 0 0 0 1 1 1 0
0 5 5 5 5 5 5 0 0 1 1 0 0 0 0 0 0 1 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
```


**output:**
```
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 2 2 2 2 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 2 2 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 4 0 4 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 4 4 4 4 4 0 0
0 5 2 5 5 5 5 0 0 0 0 0 0 0 4 0 4 0 0 0
0 5 5 5 5 5 5 0 0 0 0 0 0 0 0 0 0 0 0 0
0 5 5 5 4 5 5 0 0 0 0 0 0 0 0 0 0 0 0 0
0 5 5 5 5 5 5 0 0 6 6 0 0 0 0 0 0 3 0 0
0 5 6 5 5 3 5 0 6 6 6 6 0 0 0 0 3 3 3 0
0 5 5 5 5 5 5 0 0 6 6 0 0 0 0 0 0 3 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
```


## train_2

**input:**
```
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 5 5 5 5 5 5
0 8 8 8 8 8 8 0 0 0 0 0 0 0 0 0 5 2 5 5 5 5
0 0 8 8 8 8 0 0 0 0 0 0 0 0 0 0 5 5 5 5 5 5
0 8 8 0 0 8 8 0 0 0 0 0 0 0 0 0 5 5 5 5 5 5
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 5 5 5 3 5 5
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 5 5 5 5 5 5
0 0 0 0 0 0 0 0 0 8 8 8 0 0 0 0 5 5 5 5 5 5
0 0 0 0 0 0 0 0 8 8 8 8 8 0 0 0 5 4 5 5 5 5
0 0 0 0 0 0 0 0 8 8 8 8 8 0 0 0 5 5 5 5 5 5
0 0 0 0 0 0 0 0 0 8 0 8 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 8 0 0 0 8 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 8 8 8 8 8 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 8 8 8 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 8 8 0 8 8 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
```


**output:**
```
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 5 5 5 5 5 5
0 2 2 2 2 2 2 0 0 0 0 0 0 0 0 0 5 2 5 5 5 5
0 0 2 2 2 2 0 0 0 0 0 0 0 0 0 0 5 5 5 5 5 5
0 2 2 0 0 2 2 0 0 0 0 0 0 0 0 0 5 5 5 5 5 5
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 5 5 5 3 5 5
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 5 5 5 5 5 5
0 0 0 0 0 0 0 0 0 3 3 3 0 0 0 0 5 5 5 5 5 5
0 0 0 0 0 0 0 0 3 3 3 3 3 0 0 0 5 4 5 5 5 5
0 0 0 0 0 0 0 0 3 3 3 3 3 0 0 0 5 5 5 5 5 5
0 0 0 0 0 0 0 0 0 3 0 3 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 4 0 0 0 4 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 4 4 4 4 4 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 4 4 4 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 4 4 0 4 4 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
```

*   **Perception:**
    *   The input grids contain a distinct rectangular area composed primarily of gray pixels (color 5), which I'll call the "palette area".
    *   Within this palette area, there are a few pixels of other colors (excluding white, color 0). These act as the source colors for the transformation.
    *   Outside the palette area, there are several distinct shapes (objects) all made of a single color (blue/1 in the first example, azure/8 in the second). These are the "target objects" that will be recolored.
    *   The palette area and its internal non-gray colors remain unchanged in the output.
    *   The target objects in the input are recolored in the output using the colors found inside the palette area.
    *   The key challenge is determining the mapping: which target object gets which color from the palette.
    *   Observing the examples, the mapping seems to depend on the spatial ordering. The target objects, when ordered top-to-bottom, left-to-right based on their top-left corner, correspond to the palette colors ordered similarly (top-to-bottom, left-to-right based on their first appearance within the palette area).

*   **Facts:**
    
```yaml
    elements:
      - object: palette_area
        description: A large, contiguous rectangular region composed mostly of gray pixels (5).
        properties:
          - contains other non-white (0), non-gray (5) pixels ("palette_colors").
          - remains static between input and output.
        location: Varies (bottom-left in train_1, top-right in train_2).
      - object: palette_color_pixels
        description: Pixels within the palette_area that are not gray (5) or white (0).
        properties:
          - Act as the source colors for the transformation.
          - Their locations within the palette_area determine their order.
      - object: target_objects
        description: Contiguous shapes/objects outside the palette_area, all composed of a single identical color ("target_color").
        properties:
          - target_color: The single color making up these objects (e.g., blue (1) or azure (8)). Varies between examples.
          - location: Scattered outside the palette_area.
          - transformation: Recolorized in the output.
      - relationship: mapping
        description: A one-to-one mapping exists between the ordered target_objects and the ordered palette_colors.
        properties:
          - order_basis: Top-to-bottom, then left-to-right sorting.
          - target_object_order: Determined by the top-leftmost pixel of each object's bounding box.
          - palette_color_order: Determined by the top-leftmost pixel of the first occurrence of each unique palette color within the palette_area.

    transformation:
      - action: identify_palette_area
        description: Locate the single large contiguous gray (5) object. Determine its bounding box.
      - action: identify_palette_colors
        description: Find all unique non-gray (5), non-white (0) pixel colors within the palette_area's bounding box.
      - action: order_palette_colors
        description: For each unique palette color, find its top-leftmost occurrence within the palette_area. Sort the unique palette colors based on this location (row, then column).
      - action: identify_target_objects
        description: Find all connected objects outside the palette_area's bounding box that are neither gray (5) nor white (0). Verify they are all of the same color (the target_color).
      - action: order_target_objects
        description: For each target object, find its top-leftmost pixel. Sort the target objects based on this location (row, then column).
      - action: apply_recoloring
        description: Create the output grid by copying the input. For each target object (in order), change the color of all its pixels to the corresponding palette color (in order).
    ```


*   **Natural Language Program:**
    1.  Identify the contiguous block of gray (5) pixels; this is the "palette area". Determine its bounding box.
    2.  Scan within the bounding box of the palette area to find all pixels that are *not* gray (5) and *not* white (0). Record the color and location (row, column) of each such pixel.
    3.  Group these found pixels by their color to identify the unique "palette colors".
    4.  For each unique palette color, find the location (row, column) of its occurrence that has the minimum row index, and then the minimum column index among those with the minimum row index (i.e., the top-leftmost instance).
    5.  Create an ordered list of the unique palette colors by sorting them based on their top-leftmost instance location (primarily by row, secondarily by column).
    6.  Identify all connected components (objects) in the input grid that are located entirely *outside* the bounding box of the palette area and are composed of pixels that are neither gray (5) nor white (0).
    7.  Verify that all identified external objects are made of the exact same color. This color is the "target color".
    8.  For each target object, find the location (row, column) of its pixel that has the minimum row index, and then the minimum column index among those with the minimum row index (i.e., the top-leftmost pixel of the object).
    9.  Create an ordered list of the target objects by sorting them based on their top-leftmost pixel location (primarily by row, secondarily by column).
    10. Initialize the output grid as a copy of the input grid.
    11. Iterate through the ordered list of target objects and the ordered list of palette colors simultaneously. For the i-th target object in the list, change the color of all pixels belonging to that object in the output grid to the i-th palette color from the list.
    12. Return the modified output grid.
