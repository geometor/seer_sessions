
## train_1

**input:**
```
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 1 1 0 0 2 2 2 0 0 7 0 0 0
0 0 0 1 0 0 0 2 0 0 7 0 7 0 0
0 0 0 1 1 0 0 2 0 0 0 7 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
5 5 5 5 5 5 5 5 5 5 5 5 5 5 5
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 1 1 0 0 0 0 0
0 0 0 0 0 0 0 0 0 1 0 0 0 0 0
0 0 0 0 0 0 0 0 0 1 1 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
```


**output:**
```
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 1 1 0 0 0 0 0
0 0 0 0 0 0 0 0 0 1 0 0 0 0 0
0 0 0 0 0 0 0 0 0 1 1 0 0 0 0
0 0 0 0 0 0 0 0 0 7 0 0 0 0 0
0 0 0 0 0 0 0 0 7 0 7 0 0 0 0
0 0 0 0 0 0 0 0 0 7 0 0 0 0 0
```


## train_2

**input:**
```
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 1 0 1 0 0 2 0 0 4 4 4 0 0
0 0 0 1 0 0 0 2 0 0 4 4 4 0 0
0 0 1 0 1 0 2 2 2 0 0 4 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
5 5 5 5 5 5 5 5 5 5 5 5 5 5 5
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 1 0 1 0 0 0 0 0 0 0
0 0 0 0 0 0 1 0 0 0 0 0 0 0 0
0 0 0 0 0 1 0 1 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
```


**output:**
```
0 0 0 0 0 4 4 4 0 0 0 0 0 0 0
0 0 0 0 0 4 4 4 0 0 0 0 0 0 0
0 0 0 0 0 0 4 0 0 0 0 0 0 0 0
0 0 0 0 0 1 0 1 0 0 0 0 0 0 0
0 0 0 0 0 0 1 0 0 0 0 0 0 0 0
0 0 0 0 0 1 0 1 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
```


## train_3

**input:**
```
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 1 0 0 2 2 2 0 6 6 6 0 0
0 0 1 1 1 0 0 2 0 0 6 0 6 0 0
0 0 0 1 0 0 0 2 0 0 0 6 6 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
5 5 5 5 5 5 5 5 5 5 5 5 5 5 5
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 1 0 0 0 0 0 0 0
0 0 0 0 0 0 1 1 1 0 0 0 0 0 0
0 0 0 0 0 0 0 1 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
```


**output:**
```
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 1 0 0 0 0 0 0 0
0 0 0 0 0 0 1 1 1 0 0 0 0 0 0
0 0 0 0 0 0 0 1 0 0 0 0 0 0 0
0 0 0 0 0 0 6 6 6 0 0 0 0 0 0
0 0 0 0 0 0 6 0 6 0 0 0 0 0 0
0 0 0 0 0 0 0 6 6 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
```


## train_4

**input:**
```
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 1 1 1 0 0 2 0 0 0 3 0 0 0
0 0 1 0 1 0 0 2 0 0 3 3 3 0 0
0 0 1 1 1 0 2 2 2 0 0 3 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
5 5 5 5 5 5 5 5 5 5 5 5 5 5 5
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 1 1 1 0 0 0 0 0 0 0
0 0 0 0 0 1 0 1 0 0 0 0 0 0 0
0 0 0 0 0 1 1 1 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
```


**output:**
```
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 3 0 0 0 0 0 0 0 0
0 0 0 0 0 3 3 3 0 0 0 0 0 0 0
0 0 0 0 0 0 3 0 0 0 0 0 0 0 0
0 0 0 0 0 1 1 1 0 0 0 0 0 0 0
0 0 0 0 0 1 0 1 0 0 0 0 0 0 0
0 0 0 0 0 1 1 1 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
```

*   **Perception**:
    *   The input grid is consistently divided into two halves by a horizontal gray line (color 5).
    *   The top half contains three distinct colored objects arranged horizontally.
    *   The bottom half contains a single distinct colored object.
    *   The output grid is smaller than the input grid and contains only two objects, stacked vertically.
    *   The objects in the output are a subset of the objects originally in the top half of the input grid.
    *   The single object in the bottom half of the input grid acts as a "key". It always matches one of the objects in the top half (specifically, the leftmost object in all examples).
    *   The middle object from the top half of the input grid is always discarded. In the examples, this object is always red (color 2).
    *   The two objects kept for the output are the leftmost object (the one matching the key) and the rightmost object from the top half.
    *   The vertical stacking order of the two kept objects in the output depends on the shape of the discarded middle object from the input's top half. If the discarded object is a "Plus" shape, the leftmost object is placed on top. If the discarded object is a "T" shape, the rightmost object is placed on top.
    *   The output grid is sized minimally to contain the two stacked objects with one row of white padding above, between, and below them. The objects appear horizontally centered.

*   **Facts**:
    
```yaml
    task_structure:
      - input_grid: Represents the initial state.
      - output_grid: Represents the final state.
      - transformation: Rules defining how input becomes output.
    
    elements:
      - gray_line:
          property: A single horizontal line of gray pixels (color 5).
          role: Separator dividing the input grid into top and bottom halves.
      - objects:
          property: Contiguous blocks of non-white pixels.
          location: Found in the top and bottom halves of the input grid.
          count_top: Always 3 objects in the examples.
          count_bottom: Always 1 object (key_object) in the examples.
          relative_position_top: Leftmost, Middle, Rightmost.
          color_top_left: Always blue (color 1) in examples.
          color_top_middle: Always red (color 2) in examples.
          color_top_right: Varies (Orange, Yellow, Magenta, Green).
          color_bottom: Always blue (color 1) in examples.
          shape_top_middle: Varies ('Plus' or 'T' shape) in examples.
    
    relationships:
      - matching:
          element1: key_object (from bottom half).
          element2: Leftmost object (from top half).
          property: Identical shape and color.
          role: Confirms the key and identifies one object to keep (MatchedObject = Leftmost).
    
    actions:
      - identify_halves: Use the gray_line to split the input grid.
      - identify_objects: Find all distinct objects in the top and bottom halves.
      - match_key: Find the object in the top half matching the key_object from the bottom half.
      - identify_discarded: The middle object in the top half is discarded.
      - select_objects: Keep the matched (Leftmost) object and the Rightmost object from the top half.
      - determine_stacking_order:
          condition: Based on the shape of the discarded Middle object.
          rule_plus: If Middle object is 'Plus', stack MatchedObject above RightmostObject.
          rule_t: If Middle object is 'T', stack RightmostObject above MatchedObject.
      - construct_output:
          content: Place the two selected objects according to the determined stacking order.
          layout: Center horizontally, add 1 row white padding top, middle, and bottom.
          size: Minimal dimensions required for content and padding.
    ```


*   **Natural Language Program**:
    1.  Locate the horizontal line of gray pixels (color 5) in the input grid.
    2.  Divide the input grid into two sections: the area above the gray line (top half) and the area below the gray line (bottom half).
    3.  Identify the distinct colored objects in the top half. There will be three objects; note their shapes, colors, and relative positions (Leftmost, Middle, Rightmost).
    4.  Identify the single distinct colored object in the bottom half (the "Key Object"). Note its shape and color.
    5.  Verify that the Key Object from the bottom half has the same shape and color as the Leftmost object from the top half. Designate the Leftmost object as the "Matched Object".
    6.  Designate the Middle object from the top half as the "Discarded Object". Note its shape (e.g., 'Plus' or 'T').
    7.  Designate the Rightmost object from the top half as the "Other Object".
    8.  Determine the vertical stacking order for the output:
        *   If the shape of the Discarded Object is 'Plus', the Matched Object will be placed above the Other Object.
        *   If the shape of the Discarded Object is 'T', the Other Object will be placed above the Matched Object.
    9.  Create a new output grid, initially all white (color 0).
    10. Calculate the required dimensions for the output grid:
        *   Width: The maximum width of the Matched Object and the Other Object.
        *   Height: The height of the top stacked object + height of the bottom stacked object + 3 (for 1 row padding above, 1 between, and 1 below).
    11. Place the two selected objects (Matched Object and Other Object) into the output grid according to the determined stacking order, ensuring:
        *   There is one row of white pixels above the top object.
        *   There is one row of white pixels between the two objects.
        *   There is one row of white pixels below the bottom object.
        *   The objects are horizontally centered within the output grid width.
