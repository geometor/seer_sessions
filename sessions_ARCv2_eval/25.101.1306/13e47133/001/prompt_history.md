
## train_1

**input:**
```
7 1 1 1 1 1 1 1 2 1 1 1 1 1 1 1 1 1 1 8
1 8 1 1 1 1 1 1 2 1 1 1 1 1 1 1 1 1 4 1
1 1 1 1 1 1 1 1 2 1 1 1 1 1 1 1 1 1 1 1
1 1 1 1 1 1 1 1 2 1 1 1 1 1 1 1 1 1 1 1
1 1 1 1 1 1 1 1 2 1 1 1 1 1 1 1 1 1 1 1
1 1 1 1 1 1 1 1 2 1 1 1 1 1 1 1 1 1 1 1
1 1 1 1 1 1 1 1 2 1 1 1 1 1 1 1 1 1 1 1
1 1 1 1 1 1 1 1 2 1 1 1 1 1 1 1 1 1 1 1
1 1 1 1 1 1 1 1 2 1 1 1 1 1 1 1 1 1 1 1
1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2 1 1 1
1 1 1 1 1 1 1 1 2 1 1 1 1 1 1 3 2 1 1 1
1 1 1 1 1 1 1 1 2 1 1 1 1 1 4 1 2 1 1 1
1 1 1 1 1 1 1 1 2 1 1 1 1 1 1 1 2 1 1 1
1 1 1 1 1 1 1 1 2 1 1 1 1 1 1 1 2 1 1 1
1 1 1 1 1 1 1 1 2 1 1 1 1 1 1 1 2 1 1 1
1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2 1 1 1
1 1 1 1 1 1 1 1 2 1 1 1 1 1 1 1 1 1 1 1
1 1 1 1 1 1 1 1 2 1 1 1 1 1 1 1 1 1 1 1
1 1 1 1 1 1 1 1 2 1 1 1 1 1 1 1 1 1 1 1
1 1 1 1 1 1 1 1 2 1 1 1 1 1 1 1 1 1 1 1
```


**output:**
```
7 7 7 7 7 7 7 7 2 8 8 8 8 8 8 8 8 8 8 8
7 8 8 8 8 8 8 7 2 8 4 4 4 4 4 4 4 4 4 8
7 8 7 7 7 7 8 7 2 8 4 8 8 8 8 8 8 8 4 8
7 8 7 8 8 7 8 7 2 8 4 8 4 4 4 4 4 8 4 8
7 8 7 8 8 7 8 7 2 8 4 8 4 8 8 8 4 8 4 8
7 8 7 8 8 7 8 7 2 8 4 8 4 4 4 4 4 8 4 8
7 8 7 8 8 7 8 7 2 8 4 8 8 8 8 8 8 8 4 8
7 8 7 8 8 7 8 7 2 8 4 4 4 4 4 4 4 4 4 8
7 8 7 8 8 7 8 7 2 8 8 8 8 8 8 8 8 8 4 8
7 8 7 8 8 7 8 7 2 2 2 2 2 2 2 2 2 8 4 8
7 8 7 8 8 7 8 7 2 3 3 3 3 3 3 3 2 8 4 8
7 8 7 8 8 7 8 7 2 3 4 4 4 4 4 3 2 8 4 8
7 8 7 8 8 7 8 7 2 3 4 3 3 3 4 3 2 8 4 8
7 8 7 8 8 7 8 7 2 3 4 4 4 4 4 3 2 8 4 8
7 8 7 8 8 7 8 7 2 3 3 3 3 3 3 3 2 8 4 8
7 8 7 8 8 7 8 7 2 2 2 2 2 2 2 2 2 8 4 8
7 8 7 8 8 7 8 7 2 8 8 8 8 8 8 8 8 8 4 8
7 8 7 7 7 7 8 7 2 8 4 4 4 4 4 4 4 4 4 8
7 8 8 8 8 8 8 7 2 8 4 4 4 4 4 4 4 4 4 8
7 7 7 7 7 7 7 7 2 8 8 8 8 8 8 8 8 8 8 8
```


## train_2

**input:**
```
4 4 4 4 4 4 4 4 4 4 2 8 4 4 4 4 4 4 4 4
4 3 4 4 4 4 4 4 4 4 2 4 1 4 4 4 4 4 4 4
4 4 4 4 4 4 4 4 4 4 2 4 4 4 4 4 4 4 4 4
4 4 4 4 4 4 4 4 4 4 2 4 4 4 4 4 4 4 4 4
4 4 4 4 4 4 4 4 4 4 2 4 4 4 4 4 4 4 4 4
4 4 4 4 4 4 4 4 4 4 2 4 4 4 4 4 4 4 4 4
4 4 4 4 4 4 4 4 4 4 2 4 4 4 4 4 4 4 4 4
4 4 4 4 4 4 4 4 4 4 2 4 4 4 4 4 4 4 4 4
4 4 4 4 4 4 4 4 4 4 2 4 4 4 4 4 4 4 4 4
4 4 4 4 4 4 4 4 4 4 2 4 4 4 4 4 4 4 4 4
4 4 4 4 4 4 4 4 4 4 2 4 4 4 4 4 4 4 4 4
4 4 4 4 4 4 4 4 4 4 2 4 4 4 4 4 4 4 4 4
4 4 4 4 4 4 4 4 4 4 2 2 2 2 2 2 2 2 2 2
4 4 4 4 4 4 4 4 4 4 2 5 4 4 4 4 4 4 4 4
4 4 4 4 4 4 4 4 4 4 2 4 0 4 4 4 4 4 4 4
4 4 4 4 4 4 4 4 4 4 2 4 4 1 4 4 4 4 4 4
4 4 4 4 4 4 4 4 4 4 2 4 4 4 4 4 4 4 4 4
4 4 4 4 4 4 4 4 4 4 2 4 4 4 4 4 4 4 4 4
4 4 4 4 4 4 4 4 4 4 2 4 4 4 4 4 4 4 4 4
4 4 4 4 4 4 4 4 4 4 2 4 4 4 4 4 4 4 4 4
```


**output:**
```
4 4 4 4 4 4 4 4 4 4 2 8 8 8 8 8 8 8 8 8
4 3 3 3 3 3 3 3 3 4 2 8 1 1 1 1 1 1 1 8
4 3 4 4 4 4 4 4 3 4 2 8 1 8 8 8 8 8 1 8
4 3 4 3 3 3 3 4 3 4 2 8 1 8 1 1 1 8 1 8
4 3 4 3 4 4 3 4 3 4 2 8 1 8 1 8 1 8 1 8
4 3 4 3 4 4 3 4 3 4 2 8 1 8 1 8 1 8 1 8
4 3 4 3 4 4 3 4 3 4 2 8 1 8 1 8 1 8 1 8
4 3 4 3 4 4 3 4 3 4 2 8 1 8 1 8 1 8 1 8
4 3 4 3 4 4 3 4 3 4 2 8 1 8 1 1 1 8 1 8
4 3 4 3 4 4 3 4 3 4 2 8 1 8 8 8 8 8 1 8
4 3 4 3 4 4 3 4 3 4 2 8 1 1 1 1 1 1 1 8
4 3 4 3 4 4 3 4 3 4 2 8 8 8 8 8 8 8 8 8
4 3 4 3 4 4 3 4 3 4 2 2 2 2 2 2 2 2 2 2
4 3 4 3 4 4 3 4 3 4 2 5 5 5 5 5 5 5 5 5
4 3 4 3 4 4 3 4 3 4 2 5 0 0 0 0 0 0 0 5
4 3 4 3 4 4 3 4 3 4 2 5 0 1 1 1 1 1 0 5
4 3 4 3 3 3 3 4 3 4 2 5 0 1 5 5 5 1 0 5
4 3 4 4 4 4 4 4 3 4 2 5 0 1 1 1 1 1 0 5
4 3 3 3 3 3 3 3 3 4 2 5 0 0 0 0 0 0 0 5
4 4 4 4 4 4 4 4 4 4 2 5 5 5 5 5 5 5 5 5
```

## Perception

1.  **Grid Structure:** The input grid has a primary background color (blue, color 1 in train_1; yellow, color 4 in train_2).
2.  **Boundaries:** Red lines (color 2) act as dividers or barriers within the grid. These lines can be horizontal, vertical, or both, and may not span the entire grid.
3.  **Seed Points:** Several pixels with colors different from the background and the boundary color exist. These act as "seeds".
4.  **Transformation:** The core transformation is a type of "coloring" or "flood fill" of the background pixels. The red boundary lines remain unchanged, and the original seed pixels also retain their color and position in the output.
5.  **Color Propagation:** The background areas, separated by the red boundaries, are filled with colors derived from the seeds. It appears to be a competitive flood fill process where seeds attempt to color the background regions adjacent to them.
6.  **Priority:** When multiple seeds could potentially color the same background region, a priority rule determines the final color. Based on the examples, the seed with the lowest color index takes precedence. If color indices are equal, the seed with the lower row index takes precedence, and if rows are also equal, the lower column index takes precedence.
7.  **Fill Mechanism:** Each prioritized seed initiates a flood fill into adjacent background-colored pixels. The fill stops when it encounters a boundary pixel (red), a pixel already filled by a higher-priority seed (including original seed locations), or the grid edge.

## Facts


```yaml
task_elements:
  - role: grid_property
    type: background_color
    description: The most frequent color in the input grid, which gets replaced in the output.
    value: [blue (1) in train_1, yellow (4) in train_2]
  - role: grid_element
    type: boundary
    color: red (2)
    description: Pixels forming lines that partition the grid and act as barriers for color filling. These pixels remain unchanged.
  - role: grid_element
    type: seed
    description: Pixels with colors other than the background or boundary colors. They initiate the color filling process and retain their original color and position.
    properties: [location, color_index]
  - role: process
    type: competitive_flood_fill
    description: Background areas are filled based on flood fills originating from seed points.
    parameters:
      - seeds: All identified seed pixels.
      - background_color: The identified background color.
      - boundaries: Red (2) pixels and grid edges.
      - priority_rule: Seeds are processed in order of lowest color index, then lowest row index, then lowest column index.
      - fill_behavior: Fill propagates only into background pixels and stops at boundaries or already filled areas (including original seed locations).
  - role: relationship
    type: containment_and_adjacency
    description: Seed points are contained within regions defined by boundaries. Flood fill propagates based on adjacency to background pixels.
  - role: constraint
    type: immutability
    description: Boundary pixels (red) and original seed pixels maintain their color and location in the output grid.
```


## Natural Language Program

1.  Identify the background color (the most common color in the input grid).
2.  Identify the boundary color (red, color 2).
3.  Identify all other pixels as "seeds", noting their color and location.
4.  Create a copy of the input grid to serve as the output grid.
5.  Create a helper grid (`filled_mask`) of the same dimensions, initially all `False`, to track which pixels are considered "filled" (boundaries, seeds, or already colored by the process). Mark the locations of all boundary pixels and all initial seed pixels as `True` in the `filled_mask`.
6.  Create a list of all identified seeds.
7.  Sort the list of seeds based on a priority rule: first by the lowest color index, then by the lowest row index, and finally by the lowest column index as tie-breakers.
8.  Iterate through the sorted seeds one by one, from highest priority (lowest index values) to lowest.
9.  For the current seed (with color `seed_color` at location `seed_loc`):
    a.  Start a Breadth-First Search (BFS) or Flood Fill originating from `seed_loc`. Use a queue and add `seed_loc` to it initially.
    b.  While the BFS queue is not empty:
        i.  Get the current location (`current_loc`) from the front of the queue.
        ii. Examine the 4 direct neighbors (`neighbor_loc`) of `current_loc`.
        iii. For each `neighbor_loc` that is within the grid boundaries:
            *   Check if the pixel at `neighbor_loc` in the input grid has the background color AND if `filled_mask[neighbor_loc]` is `False`.
            *   If both conditions are true, it means this is an unfilled background pixel adjacent to the current fill area:
                *   Set the color of the pixel at `neighbor_loc` in the output grid to `seed_color`.
                *   Mark `filled_mask[neighbor_loc]` as `True`.
                *   Add `neighbor_loc` to the BFS queue to continue the fill from there.
10. After iterating through all seeds, the output grid contains the final transformed state. Return the output grid.
