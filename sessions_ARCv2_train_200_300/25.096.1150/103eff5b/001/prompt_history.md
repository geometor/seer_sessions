
## train_1

**input:**
```
0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 3 0 0 0 0 0 0 0 0
0 0 2 0 3 4 0 0 0 0 0 0 0
0 0 2 1 1 0 0 0 0 0 0 0 0
0 0 2 0 0 4 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 8 8 8 8 8 8 0 0 0 0 0
0 0 8 8 8 8 8 8 0 0 0 0 0
0 0 0 0 8 8 0 0 0 0 0 0 0
0 0 0 0 8 8 0 0 0 0 0 0 0
0 0 0 0 8 8 8 8 8 8 0 0 0
0 0 0 0 8 8 8 8 8 8 0 0 0
0 0 8 8 0 0 8 8 0 0 0 0 0
0 0 8 8 0 0 8 8 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0
```


**output:**
```
0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 3 0 0 0 0 0 0 0 0
0 0 2 0 3 4 0 0 0 0 0 0 0
0 0 2 1 1 0 0 0 0 0 0 0 0
0 0 2 0 0 4 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 2 2 2 2 2 2 0 0 0 0 0
0 0 2 2 2 2 2 2 0 0 0 0 0
0 0 0 0 1 1 0 0 0 0 0 0 0
0 0 0 0 1 1 0 0 0 0 0 0 0
0 0 0 0 1 1 3 3 3 3 0 0 0
0 0 0 0 1 1 3 3 3 3 0 0 0
0 0 4 4 0 0 4 4 0 0 0 0 0
0 0 4 4 0 0 4 4 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0
```


## train_2

**input:**
```
0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 3 1 0 0 0 0 0 0
0 0 0 4 3 0 0 0 0 0 0 0
0 0 0 2 0 4 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0
0 8 8 8 8 8 8 0 0 0 0 0
0 8 8 8 8 8 8 0 0 0 0 0
0 8 8 8 8 8 8 0 0 0 0 0
0 0 0 0 8 8 8 8 8 8 0 0
0 0 0 0 8 8 8 8 8 8 0 0
0 0 0 0 8 8 8 8 8 8 0 0
0 8 8 8 0 0 0 8 8 8 0 0
0 8 8 8 0 0 0 8 8 8 0 0
0 8 8 8 0 0 0 8 8 8 0 0
0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0
```


**output:**
```
0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 3 1 0 0 0 0 0 0
0 0 0 4 3 0 0 0 0 0 0 0
0 0 0 2 0 4 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0
0 2 2 2 4 4 4 0 0 0 0 0
0 2 2 2 4 4 4 0 0 0 0 0
0 2 2 2 4 4 4 0 0 0 0 0
0 0 0 0 3 3 3 3 3 3 0 0
0 0 0 0 3 3 3 3 3 3 0 0
0 0 0 0 3 3 3 3 3 3 0 0
0 4 4 4 0 0 0 1 1 1 0 0
0 4 4 4 0 0 0 1 1 1 0 0
0 4 4 4 0 0 0 1 1 1 0 0
0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0
```

Okay, let's break down the task based on the provided examples.

## Perception

1.  **Input Structure:** The input grids contain distinct regions. One region (let's call it the "pattern region") consists of various non-zero digits *other than* 8. Another region (let's call it the "template region") consists *only* of the digit 8. The rest of the grid is filled with 0s (background).
2.  **Output Structure:** The output grids are largely similar to the input grids. The pattern region remains completely unchanged. The background 0s also remain unchanged. The significant change occurs in the template region.
3.  **Transformation:** The areas originally occupied by the digit 8 in the input are filled with the digits found in the pattern region in the output. The digit 8 itself disappears.
4.  **Color Mapping:** The transformation isn't a simple replacement of all 8s with a single color. Instead, the template region (originally all 8s) is segmented into sub-regions in the output, each filled with a specific color from the pattern region.
5.  **Structural Preservation:** The shapes and connectivity of the sub-regions within the template area seem preserved. If the input template region consists of several disconnected components of 8s, the output maintains these disconnected components, but fills each with a color derived from the pattern region.
6.  **Mapping Logic:** The core logic appears to involve mapping the connected components of the pattern region (each with a unique color) to the connected components of the template region (originally color 8). This mapping seems based on the relative spatial positioning of these components within their respective overall regions. For example, a pattern component in the top-left of the pattern region likely dictates the color for the template component(s) in the top-left of the template region.

## Facts


```yaml
task_elements:
  - object: grid
    description: A 2D array of single digits.
    properties:
      - rows: integer
      - columns: integer
      - cells: list of lists of integers (0-9)

  - object: pattern_region
    description: An area within the input grid containing non-zero digits, excluding the digit 8.
    properties:
      - colors: set of integers (1-7, 9) present in the region.
      - location: coordinates of the cells belonging to this region.
      - components: list of connected sub-regions within the pattern region, each associated with a single color.

  - object: template_region
    description: An area within the input grid containing only the digit 8.
    properties:
      - color: 8 (constant)
      - location: coordinates of the cells belonging to this region.
      - components: list of connected sub-regions (using 8-connectivity) within the template region.

  - object: background
    description: Cells in the grid with the value 0.

relationships:
  - type: contains
    source: grid
    target: pattern_region
  - type: contains
    source: grid
    target: template_region
  - type: contains
    source: grid
    target: background
  - type: spatial_mapping
    description: >
      A correspondence exists between the pattern region components and the template region components based on their relative positions within their respective bounding boxes or overall structures.

actions:
  - action: identify_regions
    description: Locate the pattern_region and template_region within the input grid.
  - action: find_components
    description: >
      Identify the connected components within the pattern_region (grouping by color)
      and within the template_region (all color 8). 8-connectivity seems appropriate.
  - action: map_components
    description: >
      Establish a mapping from each template_region component to a pattern_region component.
      This mapping is determined by matching the relative spatial positions (e.g., using normalized centroids or bounding box centers).
  - action: replace_color
    description: >
      Create the output grid by copying the input grid. Then, for each template_region component,
      replace the color (8) of all its cells with the color of the pattern_region component it maps to.
```


## Natural Language Program

1.  **Initialize Output:** Create a copy of the input grid to serve as the basis for the output grid.
2.  **Identify Pattern Components:** Scan the input grid to find all connected components composed of non-zero digits other than 8. For each component, record its constituent cell coordinates and its single color.
3.  **Identify Template Components:** Scan the input grid to find all connected components composed solely of the digit 8. For each component, record its constituent cell coordinates.
4.  **Determine Component Mapping:**
    *   Calculate a representative point (e.g., centroid) for each pattern component and each template component.
    *   Normalize these points relative to the overall extent (e.g., bounding box) of the pattern region and template region, respectively.
    *   For each template component, find the pattern component whose normalized representative point is spatially closest (e.g., minimum Euclidean distance). This establishes the mapping.
5.  **Apply Color Transformation:** Iterate through each identified template component. Use the mapping determined in step 4 to find the corresponding pattern component and its color. Fill all cells belonging to the current template component in the *output grid* with this mapped color.
6.  **Finalize:** The modified output grid, containing the original pattern region, the background, and the color-transformed template region, is the final result.
